<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusFlow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .light-mode {
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .dark-mode {
            background-color: #1f2937;
            color: #f3f4f6;
        }
        .timer-container {
            position: relative;
            width: 300px;
            height: 300px;
        }
        .timer-svg {
            transform: rotate(-90deg);
        }
        .timer-circle {
            transition: stroke-dashoffset 0.5s ease-in-out;
        }
    </style>
</head>
<body class="dark-mode">

    <div class="min-h-screen flex flex-col items-center justify-center p-4">
        <header class="w-full max-w-4xl flex justify-between items-center mb-10">
            <h1 class="text-3xl font-bold">FocusFlow</h1>
            <div class="flex items-center space-x-4">
                <button id="menu-toggle-btn" class="p-2 rounded-full transition-colors duration-300 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-white">
                     <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
            </div>
        </header>

        <main class="w-full max-w-4xl flex flex-col items-center justify-center">
            <!-- Elemen untuk menampilkan tugas dan siklus, ditaruh di luar timer -->
            <div class="dark:bg-gray-800 p-4 rounded-xl shadow-lg transition-colors duration-300 mb-4 text-center">
                <div id="current-task-display" class="text-lg font-semibold">Tidak ada tugas terpilih</div>
                <div id="cycle-info" class="text-md font-normal mt-1">Siklus: 0 / 4</div>
            </div>
            
            <!-- Timer Pomodoro -->
            <div class="dark:bg-gray-800 p-8 rounded-full shadow-lg flex flex-col items-center justify-center transition-colors duration-300">
                <div class="timer-container">
                    <svg class="timer-svg w-full h-full" viewBox="0 0 100 100">
                        <circle class="timer-circle-bg stroke-gray-300 dark:stroke-gray-600" cx="50" cy="50" r="45" stroke-width="8" fill="transparent"/>
                        <circle id="timer-progress" class="timer-circle stroke-green-500" cx="50" cy="50" r="45" stroke-width="8" fill="transparent" stroke-linecap="round"/>
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <div id="timer-display" class="text-6xl font-bold">25:00</div>
                        <div id="timer-mode" class="text-xl mt-2 font-medium">Pomodoro</div>
                        <div id="completion-message" class="text-lg mt-4 font-semibold text-green-500 hidden">Sesi Selesai!</div>
                    </div>
                </div>
            </div>

            <div class="mt-8 flex space-x-4">
                <button id="start-btn" class="px-6 py-3 rounded-xl bg-green-500 text-white font-bold hover:bg-green-600 transition-colors duration-300">Mulai</button>
                <button id="pause-btn" class="px-6 py-3 rounded-xl bg-yellow-500 text-white font-bold hidden hover:bg-yellow-600 transition-colors duration-300">Jeda</button>
                <button id="reset-btn" class="px-6 py-3 rounded-xl bg-red-500 text-white font-bold hidden hover:bg-red-600 transition-colors duration-300">Atur Ulang</button>
                <button id="skip-btn" class="px-6 py-3 rounded-xl bg-blue-500 text-white font-bold hidden hover:bg-blue-600 transition-colors duration-300">Lewati</button>
            </div>
        </main>
    </div>

    <!-- Modal/Panel untuk Fitur Tambahan -->
    <div id="sidebar-menu" class="fixed top-0 right-0 h-full w-full max-w-sm  dark:bg-gray-800 shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out p-6 overflow-y-auto z-50">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Fitur Tambahan</h2>
            <button id="close-menu-btn" class="p-2 rounded-full text-gray-500 hover:text-gray-800 dark:hover:text-gray-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>

        <div class="space-y-8">
            <!-- Bagian Catatan Cepat -->
            <div>
                <h3 class="text-xl font-semibold mb-2">Catatan Cepat</h3>
                <input type="text" id="quick-notes-input" class="w-full p-2 rounded-lg border dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Catatan cepat..."/>
            </div>

            <!-- Bagian Daftar Tugas -->
            <div>
                <h3 class="text-xl font-semibold mb-2">Daftar Tugas</h3>
                <div id="task-list" class="space-y-2"></div>
                <div class="mt-4 flex space-x-2">
                    <input type="text" id="new-task-input" class="flex-grow p-2 rounded-lg border dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Tambah tugas baru...">
                    <button id="add-task-btn" class="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 transition-colors duration-300">Tambah</button>
                </div>
            </div>

            <!-- Bagian Pengaturan -->
            <div>
                <h3 class="text-xl font-semibold mb-2">Pengaturan Timer</h3>
                <div class="space-y-4">
                    <div>
                        <label for="pomodoro-input" class="block text-sm font-medium mb-1">Durasi Pomodoro (menit)</label>
                        <input type="number" id="pomodoro-input" value="25" min="1" class="w-full p-2 rounded-lg border dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="short-break-input" class="block text-sm font-medium mb-1">Durasi Istirahat Pendek (menit)</label>
                        <input type="number" id="short-break-input" value="5" min="1" class="w-full p-2 rounded-lg border dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="long-break-input" class="block text-sm font-medium mb-1">Durasi Istirahat Panjang (menit)</label>
                        <input type="number" id="long-break-input" value="15" min="1" class="w-full p-2 rounded-lg border dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="cycles-input" class="block text-sm font-medium mb-1">Siklus Sebelum Istirahat Panjang</label>
                        <input type="number" id="cycles-input" value="4" min="1" class="w-full p-2 rounded-lg border dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button id="save-settings-btn" class="w-full py-2 rounded-lg bg-indigo-500 text-white font-bold hover:bg-indigo-600 transition-colors duration-300">Simpan Pengaturan</button>
                </div>
            </div>

            <!-- Bagian Suara Latar Belakang -->
            <div>
                <h3 class="text-xl font-semibold mb-2">Suara Latar Belakang</h3>
                <select id="ambient-sound-select" class="w-full p-2 rounded-lg border dark:bg-gray-700 dark:border-gray-600">
                    <option value="none">Tidak Ada</option>
                    <option value="rain">Hujan</option>
                    <option value="cafe">Kafe</option>
                    <option value="forest">Hutan</option>
                </select>
            </div>
        </div>
    </div>

    <script>
        let pomodoroDuration = 25 * 60;
        let shortBreakDuration = 5 * 60;
        let longBreakDuration = 15 * 60;
        let pomodoroCycles = 4;

        let currentMode = 'pomodoro';
        let remainingTime = pomodoroDuration;
        let isRunning = false;
        let timerInterval;
        let completedPomodoros = 0;
        let ambientAudio;
        let currentTask = "Tidak ada";

        const timerDisplay = document.getElementById('timer-display');
        const timerModeDisplay = document.getElementById('timer-mode');
        const timerProgress = document.getElementById('timer-progress');
        const completionMessage = document.getElementById('completion-message');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const skipBtn = document.getElementById('skip-btn');
        const body = document.body;

        const menuToggleBtn = document.getElementById('menu-toggle-btn');
        const sidebarMenu = document.getElementById('sidebar-menu');
        const closeMenuBtn = document.getElementById('close-menu-btn');

        const taskList = document.getElementById('task-list');
        const newTaskInput = document.getElementById('new-task-input');
        const addTaskBtn = document.getElementById('add-task-btn');
        const pomodoroInput = document.getElementById('pomodoro-input');
        const shortBreakInput = document.getElementById('short-break-input');
        const longBreakInput = document.getElementById('long-break-input');
        const cyclesInput = document.getElementById('cycles-input');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const ambientSoundSelect = document.getElementById('ambient-sound-select');
        const quickNotesInput = document.getElementById('quick-notes-input');
        const currentTaskDisplay = document.getElementById('current-task-display');
        const cycleInfoDisplay = document.getElementById('cycle-info');

        // Atur radius untuk progress bar
        const radius = 45;
        const circumference = 2 * Math.PI * radius;
        timerProgress.style.strokeDasharray = circumference;

        function updateTimerDisplay() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            updateProgressBar();
        }

        function updateProgressBar() {
            let totalDuration;
            if (currentMode === 'pomodoro') {
                totalDuration = pomodoroDuration;
            } else if (currentMode === 'short-break') {
                totalDuration = shortBreakDuration;
            } else {
                totalDuration = longBreakDuration;
            }
            const offset = circumference - (remainingTime / totalDuration) * circumference;
            timerProgress.style.strokeDashoffset = offset;
        }

        function startTimer() {
            if (isRunning) return;
            isRunning = true;
            
            completionMessage.classList.add('hidden');
            startBtn.classList.add('hidden');
            pauseBtn.classList.remove('hidden');
            resetBtn.classList.remove('hidden');
            skipBtn.classList.remove('hidden');

            timerInterval = setInterval(() => {
                remainingTime--;
                updateTimerDisplay();
                if (remainingTime <= 0) {
                    endSession();
                }
            }, 1000);
        }

        function pauseTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            startBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
        }

        function resetTimer() {
            pauseTimer();
            if (currentMode === 'pomodoro') {
                remainingTime = pomodoroDuration;
            } else if (currentMode === 'short-break') {
                remainingTime = shortBreakDuration;
            } else {
                remainingTime = longBreakDuration;
            }
            updateTimerDisplay();

            startBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
            resetBtn.classList.add('hidden');
            skipBtn.classList.add('hidden');
        }

        function endSession() {
            pauseTimer();
            playNotificationSound();
            
            if (currentMode === 'pomodoro') {
                completedPomodoros++;
                completionMessage.textContent = 'Sesi Pomodoro Selesai!';
                completionMessage.classList.remove('hidden');
                updateCycleInfo();
                if (completedPomodoros % pomodoroCycles === 0) {
                    switchToMode('long-break');
                } else {
                    switchToMode('short-break');
                }
            } else {
                completionMessage.textContent = 'Istirahat Selesai!';
                completionMessage.classList.remove('hidden');
                switchToMode('pomodoro');
            }
        }

        function switchToMode(mode) {
            currentMode = mode;
            if (mode === 'pomodoro') {
                remainingTime = pomodoroDuration;
                timerModeDisplay.textContent = 'Pomodoro';
                timerProgress.style.stroke = '#10B981'; // green-500
            } else if (mode === 'short-break') {
                remainingTime = shortBreakDuration;
                timerModeDisplay.textContent = 'Istirahat Pendek';
                timerProgress.style.stroke = '#3B82F6'; // blue-500
            } else if (mode === 'long-break') {
                remainingTime = longBreakDuration;
                timerModeDisplay.textContent = 'Istirahat Panjang';
                timerProgress.style.stroke = '#8B5CF6'; // purple-500
            }
            updateTimerDisplay();
            startBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
            resetBtn.classList.remove('hidden');
            skipBtn.classList.remove('hidden');
        }
        
        function updateCycleInfo() {
            cycleInfoDisplay.textContent = `Siklus: ${completedPomodoros % pomodoroCycles} / ${pomodoroCycles}`;
        }
        
        function saveSettings() {
            pomodoroDuration = parseInt(pomodoroInput.value) * 60;
            shortBreakDuration = parseInt(shortBreakInput.value) * 60;
            longBreakDuration = parseInt(longBreakInput.value) * 60;
            pomodoroCycles = parseInt(cyclesInput.value);
            updateCycleInfo();
            
            if (currentMode === 'pomodoro') {
                remainingTime = pomodoroDuration;
                updateTimerDisplay();
            }
        }

        function playNotificationSound() {
            const audio = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'); // Placeholder sound
            audio.play();
        }

        function toggleAmbientSound() {
            const sound = ambientSoundSelect.value;
            if (ambientAudio) {
                ambientAudio.pause();
                ambientAudio.currentTime = 0;
            }

            if (sound !== 'none') {
                let url;
                switch(sound) {
                    case 'rain':
                        url = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3'; // Placeholder
                        break;
                    case 'cafe':
                        url = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3'; // Placeholder
                        break;
                    case 'forest':
                        url = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3'; // Placeholder
                        break;
                    default:
                        return;
                }
                ambientAudio = new Audio(url);
                ambientAudio.loop = true;
                ambientAudio.volume = 0.5;
                ambientAudio.play();
            }
        }

        function toggleMenu() {
            sidebarMenu.classList.toggle('translate-x-full');
        }
        
        function addTask() {
            const taskText = newTaskInput.value.trim();
            if (taskText === '') return;

            const taskItem = document.createElement('div');
            taskItem.className = 'flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer task-item';
            taskItem.innerHTML = `
                <span class="flex-grow">${taskText}</span>
                <div class="flex items-center space-x-2">
                    <button class="complete-task-btn text-green-500 hover:text-green-600 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </button>
                    <button class="delete-task-btn text-red-500 hover:text-red-600 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            `;
            
            taskList.appendChild(taskItem);
            newTaskInput.value = '';

            // Menambahkan event listener untuk memilih tugas
            taskItem.addEventListener('click', () => {
                const allTasks = document.querySelectorAll('.task-item');
                allTasks.forEach(task => task.classList.remove('bg-blue-200', 'dark:bg-blue-600'));
                taskItem.classList.add('bg-blue-200', 'dark:bg-blue-600');
                currentTask = taskText;
                currentTaskDisplay.textContent = currentTask;
            });

            taskItem.querySelector('.complete-task-btn').addEventListener('click', (e) => {
                e.stopPropagation(); // Mencegah klik menyebar ke taskItem
                taskItem.querySelector('span').classList.toggle('line-through');
            });
            taskItem.querySelector('.delete-task-btn').addEventListener('click', (e) => {
                e.stopPropagation(); // Mencegah klik menyebar ke taskItem
                taskList.removeChild(taskItem);
            });
        }

        startBtn.addEventListener('click', startTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        resetBtn.addEventListener('click', resetTimer);
        skipBtn.addEventListener('click', () => endSession());
        addTaskBtn.addEventListener('click', addTask);
        newTaskInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addTask();
            }
        });
        saveSettingsBtn.addEventListener('click', saveSettings);
        ambientSoundSelect.addEventListener('change', toggleAmbientSound);
        menuToggleBtn.addEventListener('click', toggleMenu);
        closeMenuBtn.addEventListener('click', toggleMenu);

        // Initial setup
        updateTimerDisplay();
        updateCycleInfo();
    </script>
</body>
</html>
